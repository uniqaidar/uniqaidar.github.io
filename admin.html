<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù¾Ø§Ù†ÛÙ„ÛŒ Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù† â€” UniQaidar</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&display=swap');

:root {
    --bg:       #0d0d0d;
    --surface:  #161616;
    --surface2: #1e1e1e;
    --border:   #2c2c2c;
    --accent:   #0984e3;
    --green:    #00b894;
    --red:      #e17055;
    --yellow:   #fdcb6e;
    --purple:   #a29bfe;
    --text:     #ececec;
    --muted:    #555;
    --mono:     'IBM Plex Mono', monospace;
}

* { box-sizing: border-box; margin: 0; padding: 0; }
body { background: var(--bg); color: var(--text); font-family: Tahoma, Arial, sans-serif; min-height: 100vh; direction: rtl; }

/* Ù„Û†Ø¯ÛŒÙ†Ú¯ */
#loading-screen {
    position: fixed; inset: 0; background: var(--bg);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    z-index: 9999; gap: 16px;
}
.spinner { width: 40px; height: 40px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

/* Ø³ÛØªÛ•Ù¾ */
#setup-screen {
    display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.92);
    align-items: center; justify-content: center; z-index: 9998; padding: 20px;
}
.setup-box { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 32px; max-width: 500px; width: 100%; }
.setup-box h2 { font-size: 1.2rem; margin-bottom: 6px; }
.setup-box .sub { color: var(--muted); font-size: 0.82rem; margin-bottom: 20px; line-height: 1.7; }
.setup-steps { background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 14px; font-size: 0.8rem; line-height: 2.1; margin-bottom: 20px; color: var(--muted); }
.setup-steps strong { color: var(--yellow); }
.setup-steps a { color: var(--accent); text-decoration: none; }
.setup-field { margin-bottom: 12px; }
.setup-field label { display: block; font-size: 0.75rem; color: var(--muted); margin-bottom: 5px; font-family: var(--mono); }

/* Ù‡ÛØ¯Û•Ø± */
header { background: var(--surface); border-bottom: 1px solid var(--border); padding: 13px 22px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; gap: 10px; flex-wrap: wrap; }
header h1 { font-size: 0.95rem; font-weight: bold; color: var(--accent); }
.header-right { display: flex; align-items: center; gap: 10px; }
.repo-badge { font-family: var(--mono); font-size: 0.7rem; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; padding: 4px 10px; color: var(--yellow); }
.status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--muted); flex-shrink: 0; }
.status-dot.on { background: var(--green); box-shadow: 0 0 6px var(--green); }

/* Ù†Ø§ÙˆÛ•Ú•Û†Ú© */
main { max-width: 940px; margin: 0 auto; padding: 22px 16px; display: flex; flex-direction: column; gap: 20px; }

/* ØªØ§Ø¨Û•Ú©Ø§Ù† */
.tabs { display: flex; gap: 3px; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 4px; }
.tab { flex: 1; padding: 9px 6px; text-align: center; border-radius: 7px; cursor: pointer; font-size: 0.86rem; font-weight: bold; transition: all 0.2s; color: var(--muted); border: none; background: transparent; font-family: Tahoma, Arial, sans-serif; }
.tab.active { background: var(--surface2); color: var(--text); border: 1px solid var(--border); }
.tab-content { display: none; }
.tab-content.active { display: block; }

/* Ø¨Û†Ú©Ø³ */
.box { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
.box-header { padding: 12px 18px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 10px; font-size: 0.9rem; font-weight: bold; }
.box-header .dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.box-body { padding: 18px; }

/* ÙÛ†Ø±Ù… */
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 13px; }
.form-group { display: flex; flex-direction: column; gap: 5px; }
.form-group.full { grid-column: 1 / -1; }
label { font-size: 0.75rem; color: var(--muted); font-family: var(--mono); }
input, select { background: var(--bg); border: 1px solid var(--border); color: var(--text); border-radius: 7px; padding: 9px 12px; font-size: 0.88rem; font-family: Tahoma, Arial, sans-serif; width: 100%; transition: border-color 0.2s; direction: rtl; }
input:focus, select:focus { outline: none; border-color: var(--accent); }
input[readonly] { color: var(--muted); }
input::placeholder, select::placeholder { color: var(--muted); }
select option { background: var(--surface2); }

/* Ù¾ÛŒÙ„Û•Ú©Ø§Ù†ÛŒ Ú©Ø§ØªÛÚ¯Û†Ø±ÛŒ */
.cat-pills { display: flex; flex-wrap: wrap; gap: 7px; }
.cat-pill { display: inline-flex; align-items: center; background: var(--bg); border: 1px solid var(--border); border-radius: 20px; padding: 6px 14px; cursor: pointer; font-size: 0.84rem; transition: all 0.18s; user-select: none; }
.cat-pill:hover { border-color: var(--accent); }
.cat-pill.on { background: var(--accent); border-color: var(--accent); color: #fff; }

/* Ø¯ÙˆÚ¯Ù…Û•Ú©Ø§Ù† */
.btn { padding: 9px 18px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.86rem; font-weight: bold; font-family: Tahoma, Arial, sans-serif; transition: all 0.18s; display: inline-flex; align-items: center; gap: 7px; white-space: nowrap; }
.btn:disabled { opacity: 0.45; cursor: not-allowed; }
.btn-primary { background: var(--accent); color: #fff; }
.btn-primary:hover:not(:disabled) { background: #0773c5; }
.btn-green { background: var(--green); color: #fff; }
.btn-green:hover:not(:disabled) { background: #009e7d; }
.btn-ghost { background: transparent; color: var(--muted); border: 1px solid var(--border); }
.btn-ghost:hover { color: var(--text); border-color: var(--text); }
.btn-row { display: flex; gap: 9px; justify-content: flex-end; margin-top: 14px; flex-wrap: wrap; }

/* Ø¦Ø§Ù„Û•Ø±Øª */
.alert { padding: 11px 15px; border-radius: 7px; font-size: 0.83rem; display: none; margin-top: 11px; border-right: 3px solid; line-height: 1.5; }
.alert.show { display: block; }
.alert.ok   { background: #00b89418; border-color: var(--green); color: var(--green); }
.alert.err  { background: #e1705518; border-color: var(--red);   color: var(--red); }
.alert.inf  { background: #0984e318; border-color: var(--accent); color: var(--accent); }

/* Ú©Ø§ØªÛÚ¯Û†Ø±ÛŒ Ù„ÛŒØ³Øª */
.cat-row { display: flex; align-items: center; gap: 10px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 11px 15px; }
.cat-row .lbl { flex: 1; }
.badge { font-family: var(--mono); font-size: 0.68rem; background: var(--border); padding: 3px 8px; border-radius: 4px; color: var(--yellow); }
.cnt   { font-family: var(--mono); font-size: 0.72rem; color: var(--muted); }

/* Ø¦Ø§Ø±Ø´ÛÙ */
.arc-item { display: flex; align-items: center; background: var(--bg); border: 1px solid var(--border); border-radius: 7px; padding: 9px 13px; gap: 10px; flex-wrap: wrap; }
.arc-name { font-family: var(--mono); font-size: 0.76rem; color: var(--yellow); min-width: 200px; }
.arc-prev { font-size: 0.8rem; color: var(--muted); flex: 1; }

/* Ø³Û•ÛŒÚ¤ Ø¦Û†Ú¤Û•Ø±Ù„Û•ÛŒ */
.overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75); z-index: 5000; align-items: center; justify-content: center; flex-direction: column; gap: 14px; }
.overlay.show { display: flex; }
.overlay p { color: var(--text); font-size: 0.95rem; }

/* â”€â”€ Ù…Û†Ø¯Ø§Ù„ÛŒ Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒÚ©Ø±Ø¯Ù†ÛŒ ÙÛ†Ù†Øª â”€â”€ */
.modal-backdrop {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,0.8); z-index: 4000;
    align-items: center; justify-content: center; padding: 16px;
}
.modal-backdrop.show { display: flex; }
.modal-box {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 14px; padding: 24px; width: 100%; max-width: 560px;
    max-height: 90vh; overflow-y: auto;
}
.modal-box h3 { font-size: 1rem; margin-bottom: 16px; color: var(--accent); }
.modal-footer { display: flex; gap: 9px; justify-content: flex-end; margin-top: 18px; flex-wrap: wrap; }

@media (max-width: 580px) {
    .form-grid { grid-template-columns: 1fr; }
    .form-group.full { grid-column: 1; }
    .tabs { gap: 2px; }
    .tab { font-size: 0.78rem; padding: 8px 3px; }
}
</style>
</head>
<body>

<!-- Ù„Û†Ø¯ÛŒÙ†Ú¯ -->
<div id="loading-screen">
    <div class="spinner"></div>
    <p style="color:var(--muted);font-size:0.88rem">Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ index.html Ù„Û• GitHub...</p>
</div>

<!-- Ø³ÛØªÛ•Ù¾ -->
<div id="setup-screen">
    <div class="setup-box">
        <h2>ğŸ” Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ Ø¨Û• GitHub</h2>
        <p class="sub">Ù¾Ø§Ù†ÛÙ„ Ø±ÙˆÙˆÙ†Ø§Ø³Øª Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ Ø¨Û• Ú•ÛŒÙ¾Û†ÛŒ GitHub Ø¯Û•Ú©Ø§Øª Ùˆ index.html Ø¨Û• Ø®Û†ÛŒ Ù†ÙˆÛ Ø¯Û•Ú©Ø§ØªÛ•ÙˆÛ• Ø¨Û Ø¦Û•ÙˆÛ•ÛŒ Ø¯Û•Ø³ØªØª Ù¾ÛÙˆÙ‡ Ø¨Ú¯Ø§Øª.</p>

        <div class="setup-steps">
            <strong>Ú†Û†Ù† ØªÛ†Ú©ÛÙ† Ø¯Ø±ÙˆØ³Øª Ø¨Ú©Û•ÛŒØª (ÛŒÛ•Ú© Ø¬Ø§Ø± ØªÛ•Ù†Ù‡Ø§):</strong><br>
            Ù¡. Ø¨Ú•Û† Ø¨Û† <a href="https://github.com/settings/tokens/new" target="_blank">github.com/settings/tokens/new</a><br>
            Ù¢. Ù†Ø§ÙˆÛÚ©ÛŒ Ø¨Ù†ÙˆÙˆØ³Û•: <strong>UniQaidar Admin</strong><br>
            Ù£. Ù„Û• Ø¨Û•Ø´ÛŒ <strong>Scopes</strong> ØªÛŒÚ©Ù…Ø§Ø±Ú©ÛŒ <strong>repo</strong> Ø¨Ú©Û•<br>
            Ù¤. Ú©Ù„ÛŒÚ© Ø¨Ú©Û• <strong>Generate token</strong><br>
            Ù¥. ØªÛ†Ú©ÛÙ†Û•Ú©Û• Ú©Û†Ù¾ÛŒ Ø¨Ú©Û• Ùˆ Ù„ÛØ±Û• Ø¨Ø®Ø±Û•
        </div>

        <div class="setup-field">
            <label>Ù†Ø§ÙˆÛŒ GitHub (username)</label>
            <input id="s-user" type="text" placeholder="uniqaidar">
        </div>
        <div class="setup-field">
            <label>Ù†Ø§ÙˆÛŒ Ú•ÛŒÙ¾Û† (repository name)</label>
            <input id="s-repo" type="text" placeholder="uniqaidar.github.io">
        </div>
        <div class="setup-field">
            <label>GitHub Token</label>
            <input id="s-token" type="password" placeholder="ghp_xxxxxxxxxxxxxxxxx">
        </div>

        <div id="setup-alert" class="alert"></div>

        <div class="btn-row" style="margin-top:16px">
            <button class="btn btn-primary" style="width:100%;justify-content:center;padding:12px" onclick="connect()">
                ğŸ”Œ Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ Ú©Ø±Ø¯Ù† Ùˆ Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†
            </button>
        </div>
    </div>
</div>

<!-- Ø³Û•ÛŒÚ¤ Ø¦Û†Ú¤Û•Ø±Ù„Û•ÛŒ -->
<div class="overlay" id="overlay">
    <div class="spinner"></div>
    <p id="overlay-msg">ØªÛÙ¾Û•Ú•Ø§Ù†Ø¯Ù† Ø¨Û† GitHub...</p>
</div>

<!-- Ù‡ÛØ¯Û•Ø± -->
<header>
    <h1>âš™ï¸ Ù¾Ø§Ù†ÛÙ„ÛŒ UniQaidar</h1>
    <div class="header-right">
        <span class="status-dot" id="sdot"></span>
        <span class="repo-badge" id="rbadge">Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ Ù†Û•Ú©Ø±Ø§ÙˆÛ•</span>
        <button class="btn btn-ghost" style="font-size:0.76rem;padding:5px 10px" onclick="showSetup()">Ú¯Û†Ú•ÛŒÙ†</button>
    </div>
</header>

<main>
    <div class="tabs">
        <button class="tab active" onclick="go('t-font',this)">â• Font</button>
        <button class="tab" onclick="go('t-cat',this)">ğŸ—‚ï¸ Categories</button>
        <button class="tab" onclick="go('t-arc',this)">ğŸ“‹ Archive</button>
        <button class="tab" onclick="go('t-settings',this)">âš™ï¸ Settings</button>
    </div>

    <!-- ØªØ§Ø¨ÛŒ ÙÛ†Ù†Øª -->
    <div id="t-font" class="tab-content active">
        <div class="box">
            <div class="box-header"><span class="dot" style="background:var(--accent)"></span>Add New Font</div>
            <div class="box-body">

                <!-- Step 1: Scan folder -->
                <div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:14px;margin-bottom:16px">
                    <p style="font-size:0.82rem;color:var(--muted);margin-bottom:10px">
                        <strong style="color:var(--yellow)">Step 1 â€”</strong> Choose a folder to scan for <code style="color:var(--accent)">.ttf</code> files
                    </p>
                    <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
                        <select id="scan-folder" style="flex:1;min-width:140px;max-width:200px">
                            <option value="">â€” select folder â€”</option>
                        </select>
                        <button class="btn btn-ghost" style="padding:8px 16px" onclick="scanFolder()">ğŸ” Scan</button>
                        <span id="scan-status" style="font-size:0.78rem;color:var(--muted);font-family:var(--mono)"></span>
                    </div>
                </div>

                <!-- Step 2: Pick font from dropdown -->
                <div class="form-grid">
                    <div class="form-group full">
                        <label>Step 2 â€” Select font file from scanned list</label>
                        <select id="f-select" onchange="onFontSelect()" style="font-family:var(--mono)">
                            <option value="">â€” scan a folder first â€”</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Font file name (auto-filled)</label>
                        <input id="f-name" readonly style="color:var(--muted)">
                    </div>
                    <div class="form-group">
                        <label>Folder (auto-filled)</label>
                        <input id="f-folder" readonly style="color:var(--muted)">
                    </div>
                    <div class="form-group">
                        <label>TTF path (auto)</label>
                        <input id="f-path" readonly style="color:var(--muted)">
                    </div>
                    <div class="form-group">
                        <label>ZIP path (auto)</label>
                        <input id="f-zip" readonly style="color:var(--muted)">
                    </div>
                    <div class="form-group full">
                        <label>Preview text â€” Ø¯Û•Ù‚ÛŒ Ù¾ÛŒØ´Ø§Ù†Ø¯Ø§Ù†</label>
                        <input id="f-prev" type="text" placeholder="Ú©ÙˆØ±Ø¯Ø³ØªØ§Ù†ÛŒ Ø¬ÙˆØ§Ù†">
                    </div>
                    <div class="form-group full">
                        <label>Categories â€” select one or more</label>
                        <div class="cat-pills" id="fpills"></div>
                    </div>
                </div>
                <div id="fa" class="alert"></div>
                <div class="btn-row">
                    <button class="btn btn-ghost" onclick="clearFont()">Clear</button>
                    <button class="btn btn-primary" id="fbtn" onclick="addFont()" disabled>ğŸ’¾ Add & Push to GitHub</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ØªØ§Ø¨ÛŒ Ú©Ø§ØªÛÚ¯Û†Ø±ÛŒ -->
    <div id="t-cat" class="tab-content">
        <div class="box">
            <div class="box-header"><span class="dot" style="background:var(--green)"></span>Ú©Ø§ØªÛÚ¯Û†Ø±ÛŒÛ• Ù‡Û•ÛŒÛ•Ú©Ø§Ù†</div>
            <div class="box-body">
                <div id="catlist" style="display:flex;flex-direction:column;gap:9px;margin-bottom:18px"></div>

                <div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:16px">
                    <p style="font-size:0.85rem;font-weight:bold;color:var(--green);margin-bottom:12px">â• Ú©Ø§ØªÛÚ¯Û†Ø±ÛŒ Ù†ÙˆÛ</p>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Ù†Ø§ÙˆÛŒ Ú©ÙˆØ±Ø¯ÛŒ</label>
                            <input id="nc-lbl" type="text" placeholder="Ø³Ù¾Û†Ø±Øª">
                        </div>
                        <div class="form-group">
                            <label>ID Ø¨Û• Ø¦ÛŒÙ†Ú¯Ù„ÛŒØ²ÛŒ â€” Ø¨Û Ø¨Û†Ø´Ø§ÛŒÛŒ</label>
                            <input id="nc-id" type="text" placeholder="sport">
                        </div>
                    </div>
                    <div id="ca" class="alert"></div>
                    <div class="btn-row">
                        <button class="btn btn-green" id="cbtn" onclick="addCat()" disabled>ğŸ’¾ Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù† Ùˆ ØªÛÙ¾Û•Ú•Ø§Ù†Ø¯Ù†</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ØªØ§Ø¨ÛŒ Ø¦Ø§Ø±Ø´ÛÙ -->
    <div id="t-arc" class="tab-content">
        <div class="box">
            <div class="box-header"><span class="dot" style="background:var(--purple)"></span>Ù‡Û•Ù…ÙˆÙˆ ÙÛ†Ù†ØªÛ•Ú©Ø§Ù†</div>
            <div class="box-body">
                <div style="display:flex;gap:10px;margin-bottom:13px;flex-wrap:wrap">
                    <input id="aq" type="text" placeholder="Ú¯Û•Ú•Ø§Ù†..." oninput="renderArc()" style="max-width:240px">
                    <select id="acat" onchange="renderArc()" style="max-width:170px">
                        <option value="all">Ù‡Û•Ù…ÙˆÙˆ Ú©Ø§ØªÛÚ¯Û†Ø±ÛŒÛ•Ú©Ø§Ù†</option>
                    </select>
                    <span id="acnt" style="color:var(--muted);font-size:0.78rem;font-family:var(--mono);align-self:center"></span>
                </div>
                <div id="arclist" style="display:flex;flex-direction:column;gap:7px;max-height:540px;overflow-y:auto"></div>
            </div>
        </div>
    </div>
    <!-- Settings Tab -->
    <div id="t-settings" class="tab-content">
        <div class="box" style="margin-bottom:16px">
            <div class="box-header"><span class="dot" style="background:var(--yellow)"></span>Download All Fonts â€” Link</div>
            <div class="box-body">
                <div class="form-group">
                    <label>URL for "Download All Fonts" button</label>
                    <input id="dl-url" type="text" placeholder="https://drive.google.com/...">
                </div>
                <div class="form-group" style="margin-top:10px">
                    <label>Font count label (e.g. 420)</label>
                    <input id="dl-count" type="text" placeholder="420">
                </div>
                <div id="dl-alert" class="alert"></div>
                <div class="btn-row">
                    <button class="btn btn-primary" id="dl-btn" onclick="saveDownloadLink()" disabled>ğŸ’¾ Save & Push</button>
                </div>
            </div>
        </div>

        <div class="box">
            <div class="box-header"><span class="dot" style="background:var(--purple)"></span>About Section Text</div>
            <div class="box-body">
                <div class="form-group">
                    <label>About text (shown in the â„¹ï¸ modal on the website)</label>
                    <textarea id="about-text" rows="8"
                        style="background:var(--bg);border:1px solid var(--border);color:var(--text);
                        border-radius:7px;padding:10px 12px;font-size:0.88rem;font-family:Tahoma,Arial,sans-serif;
                        width:100%;resize:vertical;direction:rtl"></textarea>
                </div>
                <div id="about-alert" class="alert"></div>
                <div class="btn-row">
                    <button class="btn btn-primary" id="about-btn" onclick="saveAbout()" disabled>ğŸ’¾ Save & Push</button>
                </div>
            </div>
        </div>
    </div>

</main>

<!-- Ù…Û†Ø¯Ø§Ù„ÛŒ Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒÚ©Ø±Ø¯Ù†ÛŒ ÙÛ†Ù†Øª -->
<div class="modal-backdrop" id="edit-modal">
    <div class="modal-box">
        <h3>âœï¸ Edit Font</h3>
        <div class="form-grid">
            <div class="form-group full">
                <label>Font File Name (readonly â€” don't change)</label>
                <input id="e-name" readonly style="color:var(--muted)">
            </div>
            <div class="form-group full">
                <label>Display Name on Card (what visitors see)</label>
                <input id="e-display" type="text" placeholder="e.g. UniQAIDAR Bahar 001">
            </div>
            <div class="form-group full">
                <label>Preview Text</label>
                <input id="e-prev" type="text" placeholder="Ú©ÙˆØ±Ø¯Ø³ØªØ§Ù†ÛŒ Ø¬ÙˆØ§Ù†">
            </div>
            <div class="form-group full">
                <label>Categories â€” select one or more</label>
                <div class="cat-pills" id="e-pills"></div>
            </div>
        </div>
        <div id="edit-alert" class="alert"></div>
        <div class="modal-footer">
            <button class="btn btn-red" onclick="deleteFont()" style="margin-left:auto">ğŸ—‘ï¸ Delete Font</button>
            <button class="btn btn-ghost" onclick="closeEditModal()">Cancel</button>
            <button class="btn btn-primary" id="edit-save-btn" onclick="saveEditFont()">ğŸ’¾ Save Changes</button>
        </div>
    </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø¯Ø§ØªØ§ÛŒ Ú¯Ù„Û†Ø¨Ø§Ù„
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let USER='', REPO='', TOKEN='';
let SHA='', RAW='';
let cats=[], fnts=[];
let ready=false;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø¯Û•Ø³ØªÙ¾ÛÚ©Ø±Ø¯Ù†
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.onload = function() {
    USER  = localStorage.getItem('u') || '';
    REPO  = localStorage.getItem('r') || '';
    TOKEN = localStorage.getItem('t') || '';
    if (USER && REPO && TOKEN) load();
    else { hide('loading-screen'); showSetup(); }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GitHub API
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function load(fromSetup) {
    show('loading-screen');
    try {
        const res  = await ghGet();
        if (!res.ok) throw 0;
        const data = await res.json();
        SHA = data.sha;
        RAW = decodeURIComponent(escape(atob(data.content.replace(/\n/g,''))));
        parse();
        buildAll();
        setReady(true);
        hide('loading-screen');
        return true;
    } catch(e) {
        hide('loading-screen');
        if (!fromSetup) showSetup();
        return false;
    }
}

function ghGet() {
    return fetch(ghUrl(), { headers: hdrs() });
}

async function ghPut(content, msg) {
    showOverlay(msg);
    try {
        const encoded = btoa(unescape(encodeURIComponent(content)));
        const res = await fetch(ghUrl(), {
            method:'PUT', headers:{...hdrs(),'Content-Type':'application/json'},
            body: JSON.stringify({ message: msg, content: encoded, sha: SHA })
        });
        if (!res.ok) throw 0;
        const data = await res.json();
        SHA = data.content.sha;
        RAW = content;
        hideOverlay();
        return true;
    } catch(e) { hideOverlay(); return false; }
}

function ghUrl() { return `https://api.github.com/repos/${USER}/${REPO}/contents/index.html`; }
function hdrs()  { return { 'Authorization': `token ${TOKEN}`, 'Accept': 'application/vnd.github.v3+json' }; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø®ÙˆÛÙ†Ø¯Ù†ÛŒ Ø¯Ø§ØªØ§ Ù„Û• ÙØ§ÛŒÙ„
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function parse() {
    cats = []; fnts = [];

    // Ú©Ø§ØªÛÚ¯Û†Ø±ÛŒÛ•Ú©Ø§Ù† â€” Ø¯ÙˆÙˆ Ø´ÛÙˆØ§Ø² Ù¾Ø´ØªÛŒÙˆØ§Ù†ÛŒ Ø¯Û•Ú©Ø§Øª
    // Ø´ÛÙˆØ§Ø²ÛŒ Ø¦ÛØ³ØªØ§: onclick="filterFonts('id', this)">
    const br = /onclick="filterFonts\('([^']+)',\s*this\)">([^<]+)<\/button>/g;
    let m;
    while ((m = br.exec(RAW)) !== null)
        cats.push({ id: m[1], label: m[2].trim() });

    // ÙÛ†Ù†ØªÛ•Ú©Ø§Ù†
    const fr = /\{\s*name:\s*"([^"]+)"[^}]*file:\s*"([^"]+)"[^}]*path:\s*"([^"]+)"[^}]*zip:\s*"([^"]+)"[^}]*category:\s*(\[[^\]]+\]|"[^"]+")\s*,\s*preview:\s*"([^"]*)"(?:[^}]*displayName:\s*"([^"]*)")?[^}]*\}/g;
    while ((m = fr.exec(RAW)) !== null) {
        let cat = m[5].trim();
        cat = cat.startsWith('[')
            ? cat.replace(/[\[\]"\s]/g,'').split(',')
            : cat.replace(/"/g,'');
        fnts.push({ name:m[1], file:m[2], path:m[3], zip:m[4], category:cat, preview:m[6], displayName: m[7] || undefined });
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showSetup() {
    document.getElementById('s-user').value  = USER;
    document.getElementById('s-repo').value  = REPO;
    document.getElementById('s-token').value = TOKEN;
    document.getElementById('setup-screen').style.display = 'flex';
}

async function connect() {
    const u = v('s-user'), r = v('s-repo'), t = v('s-token');
    const al = document.getElementById('setup-alert');
    if (!u||!r||!t) return alert2(al,'Ù‡Û•Ù…ÙˆÙˆ Ø®Ø§Ù†Û•Ú©Ø§Ù† Ù¾Ú• Ø¨Ú©Û•Ø±Û•ÙˆÛ•!','err');
    alert2(al,'Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ...','inf');
    USER=u; REPO=r; TOKEN=t;
    const ok = await load(true);
    if (ok) {
        localStorage.setItem('u',u); localStorage.setItem('r',r); localStorage.setItem('t',t);
        hide('setup-screen');
    } else {
        USER=REPO=TOKEN='';
        alert2(al,'âŒ Ù†Û•ØªÙˆØ§Ù†Ø±Ø§ Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ Ø¨Ú©Ø±ÛØª. ØªÛ†Ú©ÛÙ† ÛŒØ§Ù† Ù†Ø§ÙˆÛŒ Ú•ÛŒÙ¾Û† Ù¾Ø´Ú©Ù†Û•!','err');
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ ÙÛ†Ù†Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Folder Scanner â€” reads .ttf files from GitHub
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Known folders â€” built from categories at load time
function buildFolderList() {
    const sel = document.getElementById('scan-folder');
    const current = sel.value;
    // Get unique folder names from existing fonts
    const folders = new Set();
    fnts.forEach(f => {
        const m = f.path.match(/^fonts\/([^/]+)\//);
        if (m) folders.add(m[1]);
    });
    // Also add from category IDs that match folder names
    cats.filter(c => c.id !== 'all').forEach(c => folders.add(c.id));

    sel.innerHTML = '<option value="">â€” select folder â€”</option>';
    [...folders].sort().forEach(folder => {
        const o = document.createElement('option');
        o.value = folder;
        o.textContent = folder;
        sel.appendChild(o);
    });
    if (current) sel.value = current;
}

async function scanFolder() {
    const folder = document.getElementById('scan-folder').value;
    const status = document.getElementById('scan-status');
    const fontSel = document.getElementById('f-select');

    if (!folder) return;
    if (!ready) { status.textContent = 'âŒ Not connected to GitHub'; return; }

    status.textContent = 'Scanning...';
    fontSel.innerHTML = '<option value="">Loading...</option>';

    try {
        const res = await fetch(
            `https://api.github.com/repos/${USER}/${REPO}/contents/fonts/${folder}`,
            { headers: hdrs() }
        );
        if (!res.ok) throw new Error('Folder not found');
        const files = await res.json();

        // Filter only .ttf files, exclude already-added fonts
        const existingNames = new Set(fnts.map(f => f.name));
        const ttfFiles = files
            .filter(f => f.name.toLowerCase().endsWith('.ttf'))
            .sort((a, b) => a.name.localeCompare(b.name));

        const newFiles  = ttfFiles.filter(f => !existingNames.has(f.name.replace('.ttf', '')));
        const doneFiles = ttfFiles.filter(f =>  existingNames.has(f.name.replace('.ttf', '')));

        fontSel.innerHTML = `<option value="">â€” ${ttfFiles.length} fonts found, ${newFiles.length} new â€”</option>`;

        if (newFiles.length > 0) {
            const grpNew = document.createElement('optgroup');
            grpNew.label = `âœ… New (${newFiles.length}) â€” not in website yet`;
            newFiles.forEach(f => {
                const o = document.createElement('option');
                o.value = JSON.stringify({ name: f.name.replace('.ttf',''), folder });
                o.textContent = f.name.replace('.ttf','');
                grpNew.appendChild(o);
            });
            fontSel.appendChild(grpNew);
        }

        if (doneFiles.length > 0) {
            const grpDone = document.createElement('optgroup');
            grpDone.label = `â˜‘ï¸ Already added (${doneFiles.length})`;
            doneFiles.forEach(f => {
                const o = document.createElement('option');
                o.value = JSON.stringify({ name: f.name.replace('.ttf',''), folder });
                o.textContent = f.name.replace('.ttf','') + ' âœ“';
                o.style.color = '#555';
                grpDone.appendChild(o);
            });
            fontSel.appendChild(grpDone);
        }

        status.textContent = `âœ… ${ttfFiles.length} .ttf files found`;
        status.style.color = 'var(--green)';

    } catch(e) {
        fontSel.innerHTML = '<option value="">âŒ Could not scan folder</option>';
        status.textContent = `âŒ ${e.message}`;
        status.style.color = 'var(--red)';
    }
}

function onFontSelect() {
    const sel = document.getElementById('f-select');
    if (!sel.value) return;
    try {
        const { name, folder } = JSON.parse(sel.value);
        set('f-name',   name);
        set('f-folder', folder);
        set('f-path',   `fonts/${folder}/${name}.ttf`);
        set('f-zip',    `fonts/${folder}/${name}.zip`);
    } catch(e) {}
}

function fillPaths() {
    const n = v('f-name'), f = v('f-folder');
    set('f-path', n && f ? `fonts/${f}/${n}.ttf` : '');
    set('f-zip',  n && f ? `fonts/${f}/${n}.zip`  : '');
}

async function addFont() {
    const name   = document.getElementById('f-name').value.trim();
    const folder = document.getElementById('f-folder').value.trim();
    const prev   = document.getElementById('f-prev').value.trim() || 'Ú©ÙˆØ±Ø¯Ø³ØªØ§Ù†ÛŒ Ø¬ÙˆØ§Ù†';
    const al     = document.getElementById('fa');
    const picked = [...document.querySelectorAll('#fpills .cat-pill.on')].map(p => p.dataset.id);

    if (!name)          return alert2(al, 'âŒ Please select a font from the dropdown first!', 'err');
    if (!folder)        return alert2(al, 'âŒ No folder selected!', 'err');
    if (!picked.length) return alert2(al, 'âŒ Select at least one category!', 'err');
    if (fnts.find(f => f.name === name)) return alert2(al, `âŒ "${name}" is already on the website!`, 'err');

    const path   = `fonts/${folder}/${name}.ttf`;
    const zip    = `fonts/${folder}/${name}.zip`;
    const catVal = picked.length === 1 ? `"${picked[0]}"` : `["${picked.join('","')}"]`;

    // â‘  @font-face â€” after last existing one
    const face = `@font-face { font-family: '${name}'; src: url('${path}'); }\n`;
    const li   = RAW.lastIndexOf('@font-face');
    const at   = RAW.indexOf('\n', li) + 1;
    let next   = RAW.slice(0, at) + face + RAW.slice(at);

    // â‘¡ Insert at TOP of fonts array (appears first = newest on top)
    const entry   = `    { name: "${name}", file: "${name}", path: "${path}", zip: "${zip}", category: ${catVal}, preview: "${prev}" },\n`;
    const arrOpen = next.indexOf('const fonts = [\n') + 'const fonts = [\n'.length;
    next = next.slice(0, arrOpen) + entry + next.slice(arrOpen);

    alert2(al, 'Pushing to GitHub...', 'inf');
    const ok = await ghPut(next, `Add font: ${name}`);

    if (ok) {
        fnts.unshift({ name, file: name, path, zip, category: picked.length === 1 ? picked[0] : picked, preview: prev });
        alert2(al, `âœ… "${name}" added! It will appear at the top of its category.`, 'ok');
        clearFont();
        buildFolderList();
        buildCatList();
        renderArc();
    } else {
        alert2(al, 'âŒ Push failed. Check your token!', 'err');
    }
}

function clearFont() {
    ['f-name','f-folder','f-path','f-zip','f-prev'].forEach(i => set(i,''));
    document.getElementById('f-select').innerHTML = '<option value="">â€” scan a folder first â€”</option>';
    document.getElementById('scan-status').textContent = '';
    document.querySelectorAll('#fpills .cat-pill').forEach(p => p.classList.remove('on'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú©Ø§ØªÛÚ¯Û†Ø±ÛŒ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function addCat() {
    const lbl = v('nc-lbl'), id = v('nc-id');
    const al  = document.getElementById('ca');

    if (!lbl||!id)                   return alert2(al,'Ù‡Û•Ø±Ø¯ÙˆÙˆ Ø®Ø§Ù†Û•Ú©Ø§Ù† Ù¾Ú• Ø¨Ú©Û•Ø±Û•ÙˆÛ•!','err');
    if (/\s/.test(id))               return alert2(al,'ID Ù†Ø§Ø¨ÛØª Ø¨Û†Ø´Ø§ÛŒÛŒ Ù‡Û•Ø¨ÛØª!','err');
    if (cats.find(c=>c.id===id))     return alert2(al,'Ø¦Û•Ù… Ú©Ø§ØªÛÚ¯Û†Ø±ÛŒÛ• Ù¾ÛØ´ØªØ± Ù‡Û•ÛŒÛ•!','err');

    // Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø¯ÙˆÚ¯Ù…Û•ÛŒ ÙÙ„ØªÛ•Ø± Ù„Û• HTML â€” Ø´ÛÙˆØ§Ø²ÛŒ Ú¯ÙˆÙ†Ø¬Ø§Ùˆ
    const btn    = `\n            <button class="filter-btn" onclick="filterFonts('${id}', this)">${lbl}</button>`;
    const marker = '</div>\n    </div>\n</div>\n\n<div class="font-grid"';
    const pos    = RAW.indexOf(marker);
    if (pos===-1) return alert2(al,'âŒ Ø´ÙˆÛÙ†ÛŒ Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù† Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•!','err');

    // Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù† Ø¯ÙˆØ§ÛŒ Ú©Û†ØªØ§ÛŒÛŒÙ† Ø¯ÙˆÚ¯Ù…Û•ØŒ Ù¾ÛØ´ Ø®Û•ØªÛ•Ú©Ø§Ù†ÛŒ Ø¯Ø§Ø®Ø³ØªÙ†
    const lastBtnEnd = RAW.lastIndexOf('</button>', pos) + '</button>'.length;
    const next = RAW.slice(0, lastBtnEnd) + btn + RAW.slice(lastBtnEnd);

    alert2(al,'ØªÛÙ¾Û•Ú•Ø§Ù†Ø¯Ù†...','inf');
    const ok = await ghPut(next, `Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú©Ø§ØªÛÚ¯Û†Ø±ÛŒ: ${lbl}`);

    if (ok) {
        cats.push({ id, label:lbl });
        set('nc-lbl',''); set('nc-id','');
        buildCatPills(); buildCatList(); buildArcSel();
        alert2(al,`âœ… Ú©Ø§ØªÛÚ¯Û†Ø±ÛŒ "${lbl}" Ø²ÛŒØ§Ø¯Ú©Ø±Ø§!`,'ok');
    } else {
        alert2(al,'âŒ Ù‡Û•ÚµÛ•. ØªÛ†Ú©ÛÙ†Û•Ú©Û•Øª Ù¾Ø´Ú©Ù†Û•!','err');
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ UI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildAll() { buildCatPills(); buildCatList(); buildArcSel(); buildFolderList(); renderArc(); }

function buildCatPills() {
    const w = document.getElementById('fpills');
    w.innerHTML = '';
    cats.filter(c=>c.id!=='all').forEach(c => {
        const p = document.createElement('span');
        p.className = 'cat-pill';
        p.dataset.id = c.id;
        p.textContent = c.label;
        p.onclick = function() { this.classList.toggle('on'); };
        w.appendChild(p);
    });
}

function buildCatList() {
    const l = document.getElementById('catlist');
    l.innerHTML = '';
    cats.forEach((c, idx) => {
        const n = fnts.filter(f => {
            const fc = Array.isArray(f.category) ? f.category : [f.category];
            return fc.includes(c.id);
        }).length;
        const row = document.createElement('div');
        row.className = 'cat-row';
        row.style.cssText = 'flex-wrap:wrap;gap:8px';
        row.innerHTML = `
            <span class="lbl" id="lbl-${idx}">${c.label}</span>
            <input id="inp-${idx}" value="${c.label}" style="display:none;flex:1;min-width:120px;max-width:180px">
            <span class="badge">${c.id}</span>
            <span class="cnt">${n} fonts</span>
            <button class="btn btn-ghost" style="padding:4px 10px;font-size:0.75rem" onclick="startEdit(${idx})">âœï¸ Rename</button>
            <button class="btn btn-red" style="padding:4px 10px;font-size:0.75rem" onclick="deleteCat(${idx})">ğŸ—‘ï¸</button>
            <button class="btn btn-primary" id="savebtn-${idx}" style="display:none;padding:4px 10px;font-size:0.75rem" onclick="saveCatName(${idx})">ğŸ’¾ Save</button>
            <button class="btn btn-ghost" id="cancelbtn-${idx}" style="display:none;padding:4px 10px;font-size:0.75rem" onclick="cancelEdit(${idx})">Cancel</button>
        `;
        l.appendChild(row);
    });
    // Ø¦Ø§Ù„Û•Ø±ØªÛŒ Ù†Ø§ÙˆÚ¯Û†Ú•ÛŒÙ†
    if (!document.getElementById('rename-alert')) {
        const al = document.createElement('div');
        al.id = 'rename-alert'; al.className = 'alert';
        l.after(al);
    }
}

function buildArcSel() {
    const s = document.getElementById('acat');
    s.innerHTML = '<option value="all">Ù‡Û•Ù…ÙˆÙˆ Ú©Ø§ØªÛÚ¯Û†Ø±ÛŒÛ•Ú©Ø§Ù†</option>';
    cats.filter(c=>c.id!=='all').forEach(c => {
        const o = document.createElement('option');
        o.value=c.id; o.textContent=c.label; s.appendChild(o);
    });
}

function renderArc() {
    const q   = v('aq').toLowerCase();
    const cat = document.getElementById('acat').value;
    const l   = document.getElementById('arclist');
    const res = fnts.filter(f => {
        const fc = Array.isArray(f.category) ? f.category : [f.category];
        return (cat==='all' || fc.includes(cat)) && f.name.toLowerCase().includes(q);
    });
    document.getElementById('acnt').textContent = `${res.length} fonts`;
    l.innerHTML = '';
    if (!res.length) {
        l.innerHTML = '<div style="color:var(--muted);text-align:center;padding:24px;font-size:0.83rem">No fonts found</div>';
        return;
    }
    res.forEach(f => {
        const fc  = Array.isArray(f.category) ? f.category.join(', ') : f.category;
        const idx = fnts.indexOf(f);
        const d   = document.createElement('div');
        d.className = 'arc-item';
        d.innerHTML = `
            <span class="arc-name">${f.name}</span>
            ${f.displayName ? `<span style="color:var(--accent);font-size:0.78rem">${f.displayName}</span>` : ''}
            <span class="arc-prev">${f.preview || ''}</span>
            <span class="badge">${fc}</span>
            <button class="btn btn-ghost" style="padding:4px 10px;font-size:0.75rem;margin-right:auto"
                onclick="openEditModal(${idx})">âœï¸ Edit</button>
        `;
        l.appendChild(d);
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒÚ©Ø±Ø¯Ù†ÛŒ ÙÛ†Ù†ØªÛŒ Ù‡Û•Ø¨ÙˆÙˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let editIdx = -1;

function openEditModal(idx) {
    editIdx = idx;
    const f = fnts[idx];
    const curCats = Array.isArray(f.category) ? f.category : [f.category];

    set('e-name', f.name);
    set('e-display', f.displayName || '');
    set('e-prev', f.preview || '');

    // Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ Ù¾ÛŒÙ„Û•Ú©Ø§Ù†ÛŒ Ú©Ø§ØªÛÚ¯Û†Ø±ÛŒ Ø¨Û† Ù…Û†Ø¯Ø§Ù„
    const pills = document.getElementById('e-pills');
    pills.innerHTML = '';
    cats.filter(c => c.id !== 'all').forEach(c => {
        const p = document.createElement('span');
        p.className = 'cat-pill' + (curCats.includes(c.id) ? ' on' : '');
        p.dataset.id = c.id;
        p.textContent = c.label;
        p.onclick = function() { this.classList.toggle('on'); };
        pills.appendChild(p);
    });

    document.getElementById('edit-alert').className = 'alert';
    document.getElementById('edit-modal').classList.add('show');
}

function closeEditModal() {
    document.getElementById('edit-modal').classList.remove('show');
    editIdx = -1;
}

async function saveEditFont() {
    if (editIdx < 0) return;
    const f          = fnts[editIdx];
    const newPrev    = v('e-prev') || 'Ú©ÙˆØ±Ø¯Ø³ØªØ§Ù†ÛŒ Ø¬ÙˆØ§Ù†';
    const newDisplay = v('e-display').trim();
    const picked     = [...document.querySelectorAll('#e-pills .cat-pill.on')].map(p => p.dataset.id);
    const al         = document.getElementById('edit-alert');

    if (!picked.length) return alert2(al, 'Select at least one category!', 'err');

    const newCatVal = picked.length === 1
        ? `"${picked[0]}"`
        : `["${picked.join('","')}"]`;

    const escaped = f.name.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    const entryRx = new RegExp(`\\{\\s*name:\\s*"${escaped}"[^}]*preview:\\s*"[^"]*"[^}]*\\}`, '');
    const oldEntry = RAW.match(entryRx);
    if (!oldEntry) return alert2(al, `âŒ Could not find font "${f.name}" in index.html!`, 'err');

    let newEntry = oldEntry[0]
        .replace(/category:\s*(\[[^\]]+\]|"[^"]+")/, `category: ${newCatVal}`)
        .replace(/preview:\s*"[^"]*"/, `preview: "${newPrev}"`);

    // displayName: Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù† ÛŒØ§Ù† Ù†ÙˆÛÚ©Ø±Ø¯Ù†Û•ÙˆÛ•
    if (newDisplay) {
        if (/displayName:\s*"[^"]*"/.test(newEntry)) {
            newEntry = newEntry.replace(/displayName:\s*"[^"]*"/, `displayName: "${newDisplay}"`);
        } else {
            newEntry = newEntry.replace(/\s*\}$/, `, displayName: "${newDisplay}" }`);
        }
    } else {
        newEntry = newEntry.replace(/,?\s*displayName:\s*"[^"]*"/, '');
    }

    const next = RAW.replace(oldEntry[0], newEntry);
    alert2(al, 'Saving to GitHub...', 'inf');
    const ok = await ghPut(next, `Edit font: ${f.name}`);

    if (ok) {
        fnts[editIdx].preview     = newPrev;
        fnts[editIdx].displayName = newDisplay || undefined;
        fnts[editIdx].category    = picked.length === 1 ? picked[0] : picked;
        alert2(al, `âœ… "${f.name}" updated!`, 'ok');
        buildCatList(); renderArc();
        setTimeout(closeEditModal, 1200);
    } else {
        alert2(al, 'âŒ Save failed. Check your token!', 'err');
    }
}

async function deleteFont() {
    if (editIdx < 0) return;
    const f  = fnts[editIdx];
    const al = document.getElementById('edit-alert');
    if (!confirm(`Delete "${f.name}" from the website?\n\nNote: Only removes it from index.html. The .ttf/.zip files on GitHub stay.`)) return;

    const escaped = f.name.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    const faceRx  = new RegExp(`@font-face \\{ font-family: '${escaped}';[^\\n]+\\n`, '');
    const entryRx = new RegExp(`\\n?[ \\t]*\\{[ \\t]*name:[ \\t]*"${escaped}"[^}]*preview:[^}]*\\}[ \\t]*,?`, '');

    let next = RAW.replace(faceRx, '').replace(entryRx, '');

    alert2(al, 'Deleting from GitHub...', 'inf');
    const ok = await ghPut(next, `Delete font: ${f.name}`);
    if (ok) {
        fnts.splice(editIdx, 1);
        alert2(al, `âœ… "${f.name}" deleted from website!`, 'ok');
        buildCatList(); renderArc();
        setTimeout(closeEditModal, 1000);
    } else {
        alert2(al, 'âŒ Delete failed. Check your token!', 'err');
    }
}

// Ø¯Ø§Ø®Ø³ØªÙ†ÛŒ Ù…Û†Ø¯Ø§Ù„ Ø¨Û• Ú©Ù„ÛŒÚ©ÛŒ Ø¯Û•Ø±Û•ÙˆÛ•
document.getElementById('edit-modal').addEventListener('click', function(e) {
    if (e.target === this) closeEditModal();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function startEdit(idx) {
    document.getElementById('lbl-'+idx).style.display = 'none';
    document.getElementById('inp-'+idx).style.display = 'inline-block';
    document.getElementById('savebtn-'+idx).style.display = 'inline-flex';
    document.getElementById('cancelbtn-'+idx).style.display = 'inline-flex';
    document.getElementById('inp-'+idx).focus();
}

function cancelEdit(idx) {
    document.getElementById('inp-'+idx).value = cats[idx].label;
    document.getElementById('lbl-'+idx).style.display = '';
    document.getElementById('inp-'+idx).style.display = 'none';
    document.getElementById('savebtn-'+idx).style.display = 'none';
    document.getElementById('cancelbtn-'+idx).style.display = 'none';
}

async function saveCatName(idx) {
    const newLabel = document.getElementById('inp-'+idx).value.trim();
    const al = document.getElementById('rename-alert');
    const oldLabel = cats[idx].label;
    const id = cats[idx].id;

    if (!newLabel) return alert2(al, 'Name cannot be empty!', 'err');
    if (newLabel === oldLabel) { cancelEdit(idx); return; }

    // Ú¯Û†Ú•ÛŒÙ†ÛŒ Ù†Ø§Ùˆ Ù„Û• HTML â€” Ø¯ÙˆÚ¯Ù…Û•ÛŒ ÙÙ„ØªÛ•Ø±
    // Ø´ÛÙˆØ§Ø²: onclick="filterFonts('nwe', this)">Ù†ÙˆÛ</button>
    const oldBtn = `onclick="filterFonts('${id}', this)">${oldLabel}</button>`;
    const newBtn = `onclick="filterFonts('${id}', this)">${newLabel}</button>`;

    if (!RAW.includes(oldBtn)) {
        return alert2(al, `âŒ Could not find the button for "${id}" in index.html. File may have changed.`, 'err');
    }

    const next = RAW.replace(oldBtn, newBtn);

    alert2(al, 'Saving to GitHub...', 'inf');
    const ok = await ghPut(next, `Rename category: ${oldLabel} â†’ ${newLabel}`);

    if (ok) {
        cats[idx].label = newLabel;
        buildCatPills();
        buildCatList();
        buildArcSel();
        alert2(document.getElementById('rename-alert'), `âœ… "${oldLabel}" renamed to "${newLabel}"`, 'ok');
    } else {
        alert2(document.getElementById('rename-alert'), 'âŒ Save failed. Check your token!', 'err');
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function setReady(val) {
    ready = val;
    const dot = document.getElementById('sdot');
    dot.className = 'status-dot' + (val ? ' on' : '');
    document.getElementById('rbadge').textContent = val ? `${USER}/${REPO}` : 'Not connected';
    document.getElementById('fbtn').disabled  = !val;
    document.getElementById('cbtn').disabled  = !val;
    document.getElementById('dl-btn').disabled    = true; // loaded on tab open
    document.getElementById('about-btn').disabled = true;
}

function go(id, btn) {
    document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    btn.classList.add('active');
    if (id==='t-arc') renderArc();
    if (id==='t-settings') loadSettings();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Delete Category
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function deleteCat(idx) {
    const c = cats[idx];
    if (c.id === 'all') return alert('Cannot delete the "All" category.');
    const n = fnts.filter(f => {
        const fc = Array.isArray(f.category) ? f.category : [f.category];
        return fc.includes(c.id);
    }).length;
    const msg = n > 0
        ? `Delete category "${c.label}"?\n\nâš ï¸ ${n} font(s) are in this category. They will still exist but won't appear under this category.`
        : `Delete category "${c.label}"?`;
    if (!confirm(msg)) return;

    const lineRx = new RegExp(`[ \\t]*<button[^>]*filterFonts\\('${c.id.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')}'[^>]*>[^<]*<\\/button>\\r?\\n?`, '');
    const next   = RAW.replace(lineRx, '');
    if (next === RAW) return alert(`âŒ Could not find button for "${c.id}" in index.html.`);

    showOverlay(`Deleting category: ${c.label}...`);
    const ok = await ghPut(next, `Delete category: ${c.label}`);
    if (ok) {
        cats.splice(idx, 1);
        buildCatPills(); buildCatList(); buildArcSel();
    } else {
        alert('âŒ Delete failed. Check your token!');
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Settings: Download Link + About Text
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadSettings() {
    // Ù„ÛŒÙ†Ú©ÛŒ Ø¯Ø§Ú¯Ø±ØªÙ†
    const dlMatch = RAW.match(/href="([^"]*)"[^>]*>\s*<i[^>]*><\/i>[^<]*\u06a9\u0644\u06cc\u06a9/);
    if (dlMatch) set('dl-url', dlMatch[1]);
    // Ú˜Ù…Ø§Ø±Û•ÛŒ ÙÛ†Ù†ØªÛ•Ú©Ø§Ù†
    const cntMatch = RAW.match(/\u062f\u0627\u06af\u0631\u062a\u0646\u06cc\s+(\d+)\s+\u0641\u06c6\u0646\u062a\u06cc/);
    if (cntMatch) set('dl-count', cntMatch[1]);
    // Ø¯Û•Ù‚ÛŒ Ø¯Û•Ø±Ø¨Ø§Ø±Û•
    const am = RAW.match(/<p>([\u0600-\u06ff\s\S]*?UniQaidar[\s\S]*?)<\/p>/);
    if (am) document.getElementById('about-text').value = am[1].replace(/<br\s*\/?>/g, '\n').trim();
    // enable buttons
    document.getElementById('dl-btn').disabled    = false;
    document.getElementById('about-btn').disabled = false;
}

async function saveDownloadLink() {
    const url   = v('dl-url');
    const count = v('dl-count');
    const al    = document.getElementById('dl-alert');
    if (!url) return alert2(al, 'Enter the download URL!', 'err');

    let next = RAW.replace(/href="[^"]*"(\s*target="_blank"\s*class="header-btn")/, `href="${url}"$1`);
    if (count) next = next.replace(/(\u062f\u0627\u06af\u0631\u062a\u0646\u06cc\s+)\d+(\s+\u0641\u06c6\u0646\u062a\u06cc)/, `$1${count}$2`);

    alert2(al, 'Saving...', 'inf');
    const ok = await ghPut(next, 'Update: download link');
    if (ok) alert2(al, 'âœ… Download link updated!', 'ok');
    else    alert2(al, 'âŒ Save failed. Check your token!', 'err');
}

async function saveAbout() {
    const text = document.getElementById('about-text').value.trim();
    const al   = document.getElementById('about-alert');
    if (!text) return alert2(al, 'About text cannot be empty!', 'err');

    const htmlText = text.replace(/\n/g, '\n');
    // Ø¬ÛÚ¯Ø±ØªÙ†Û•ÙˆÛ•ÛŒ Ø¯Û•Ù‚ÛŒ Ø¯Û•Ø±Ø¨Ø§Ø±Û•
    const next = RAW.replace(
        /(<p>)([\u0600-\u06ff][^<]*UniQaidar[^<]*(?:<br[^>]*>[^<]*)*)((?:\n[^<]*)?)(<\/p>)/,
        `<p>${htmlText}</p>`
    );
    alert2(al, 'Saving...', 'inf');
    const ok = await ghPut(next, 'Update: about section');
    if (ok) alert2(al, 'âœ… About text updated!', 'ok');
    else    alert2(al, 'âŒ Save failed. Check your token!', 'err');
}

function showOverlay(msg) { document.getElementById('overlay-msg').textContent = msg || '...'; document.getElementById('overlay').classList.add('show'); }
function hideOverlay()    { document.getElementById('overlay').classList.remove('show'); }
function show(id) { document.getElementById(id).style.display = 'flex'; }
function hide(id) { document.getElementById(id).style.display = 'none'; }
function v(id)    { return document.getElementById(id).value.trim(); }
function set(id,val) { document.getElementById(id).value = val; }
function alert2(el, msg, type) { el.textContent=msg; el.className=`alert ${type} show`; }
</script>
</body>
</html>

